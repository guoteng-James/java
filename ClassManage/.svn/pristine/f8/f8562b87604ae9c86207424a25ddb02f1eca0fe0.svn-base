package com.demo.controller;

import java.io.File;
import java.io.IOException;
import java.util.Date;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.commons.io.IOUtils;
import org.omg.CORBA.Request;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.ModelAndView;
@RequestMapping("/test")
public class TestController {
//	@Autowired
//	UserService userService;
//	
//	@Value("${HHH}")
//	private String hh;
//	@RequestMapping("/test1/{id}")
//	public String Test1(@PathVariable String id) throws UnsupportedEncodingException{
////		System.out.println("helo");
////		System.out.println(hh);
//		System.out.println(new String(id.getBytes("ISO-8859-1"),"UTF-8"));
//		userService.setName(1,"adas");
//		return "index";
//	}
//	@RequestMapping("/")
//	public String main(){
//		return "main";
//	}
	@RequestMapping("/upload")
	public String upload(MultipartFile file,HttpServletRequest request,HttpServletResponse response){
		
		
		System.out.println(file.getOriginalFilename());
		String webapp=request.getSession().getServletContext().getRealPath("");
		int index=webapp.lastIndexOf("\\");
		System.out.println(webapp);
		String path=webapp.substring(0,index)+"\\upload";
		System.out.println(path);
		File dir=new File(path);
		if (!dir.exists()) {
			dir.mkdirs();
		}
		System.out.println(path);
		int suffix=file.getOriginalFilename().lastIndexOf(".");	
		String saveFile=new Date().getTime()+file.getOriginalFilename().substring(suffix);
		File result=new File(path+"//"+saveFile);
		System.out.println(path+"//"+saveFile);
		if (!result.exists()) {
			try {
				result.createNewFile();
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
		try {
			file.transferTo(result);
		} catch (IllegalStateException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		request.setAttribute("file", saveFile);
		request.setAttribute("path", result.getAbsolutePath());
		return "success";
	}
//	@RequestMapping(value="/download",method={RequestMethod.POST,RequestMethod.GET})
//	public Student download(String fileName,HttpServletRequest request,HttpServletResponse response) throws FileNotFoundException, IOException{
//		Student student=new Student();
//		student.setSname("123");
//		student.setSage("21");
//		String webapp=request.getSession().getServletContext().getRealPath("");
//		int index=webapp.lastIndexOf("\\");
//		String path=webapp.substring(0,index)+"\\upload";
//		File result=new File(path+"//"+fileName);
//		System.out.println(result.getAbsolutePath());
//		System.out.println(result.exists());
//		 response.addHeader("content-disposition", "attachment;filename=" + fileName);
//		
//		IOUtils.copy(new FileInputStream(result), response.getOutputStream());
//		
//		return null;
//	}
//	@RequestMapping(value="/pojo",method={RequestMethod.POST,RequestMethod.GET})
//	public String pojo(Class1 class1,Set name){
////		System.out.println(class1.getStudent().getSname()+"..."+class1.getStudent().getSage());
////		System.out.println(class1.getTeacher().getTname()+"..."+class1.getTeacher().getTage());
//		System.out.println(name.size());
//		return "success";
//	}
}
